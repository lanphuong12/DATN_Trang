<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Sổ Cái Tài Khoản</title>
  <style>
    body {
      font-family: "Times New Roman", serif;
      margin: 30px;
    }
    .header, .footer {
      width: 100%;
      display: flex;
      justify-content: space-between;
    }
    .company-info {
      text-align: left;
      font-size: 14px;
    }
    .national-title {
      text-align: right;
      font-size: 14px;
      text-align: center;
    }
    .national-title b {
      display: block;
    }
    .national-title p {
      width: 220px;
      margin-left: auto;
      margin-top: 2px;
      margin-bottom: 0;
    }
    h2 {
      text-align: center;
      margin: 20px 0 5px;
      text-transform: uppercase;
    }
    .subtitle {
      text-align: center;
      margin-bottom: 20px;
      font-size: 14px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-bottom: 30px;
      font-size: 14px;
    }
    th, td {
      border: 1px solid #000;
      padding: 4px;
      text-align: center;
    }
    td.left {
      text-align: left;
    }
    .footer-signature {
      display: flex;
      justify-content: space-between;
      margin-top: 50px;
      font-size: 14px;
    }
    .signature-block {
      text-align: center;
      width: 30%;
    }
    .signature-block .title {
      font-weight: bold;
      margin-bottom: 5px;
    }
    .signature-block .note {
      font-style: italic;
      margin-bottom: 80px;
    }
    .signature-block .name {
      text-transform: uppercase;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <div class="header">
    <div class="company-info">
      <strong>CÔNG TY TNHH SẢN XUẤT VÀ THƯƠNG MẠI HÙNG LONG</strong><br />
      <strong>Địa chỉ: thôn Tráng Vũ - xã Đồng Than - huyện Yên Mỹ - tỉnh Hưng Yên</strong><br />
      <strong>Mã số thuế: 0900581808</strong>
    </div>
    <div class="national-title">
      <p style="font-style: italic">Ban hành kèm theo thông tư số</p>
      <p style="font-style: italic">200/2014/TT-BTC ngày</p>
      <p style="font-style: italic">22/12/2014 của Bộ Tài chính</p>
    </div>
  </div>

  <h2>SỔ CÁI TÀI KHOẢN</h2>
  <div class="subtitle">

    Từ ngày <strong><span id="ngaybatdau"></span></strong> đến ngày <strong><span id="ngayketthuc"></span></strong><br />
    Tài khoản: <strong>131 - Phải thu của khách hàng</strong>
    

  </div>
  <table>
    <tr>
      <th rowspan="2" style="width: 80px; word-wrap: break-word; white-space: normal;">Ngày tháng ghi sổ</th>
      <th colspan="2">Chứng từ</th>
      <th rowspan="2">Diễn giải</th>
      <th colspan="2">Nhật ký chung</th>
      <th rowspan="2" style="width: 80px; word-wrap: break-word; white-space: normal;">Số hiệu TK đối ứng</th>
      <th colspan="2">Số tiền</th>
    </tr>
    <tr>
      <th>Số hiệu</th>
      <th>Ngày</th>
      <th style="width: 30px;">Trang số</th>
      <th style="width: 30px;">STT dòng</th>
      <th style="width: 100px;">Nợ</th>
      <th style="width: 100px;">Có</th>
    </tr>
    <tr>
      <td><b>A</b></td>
      <td><b>B</b></td>
      <td><b>C</b></td>
      <td><b>D</b></td>
      <td><b>E</b></td>
      <td><b>G</b></td>
      <td><b>H</b></td>
      <td><b>1</b></td>
      <td><b>2</b></td>
    </tr>
    <tr>
      <td> </td>
      <td>  </td>
      <td> </td>
      <td>Số dư đầu kỳ</td>
      <td></td>
      <td></td>
      <td></td>
      <td><span id="soduno"></span></td>
      <td><span id="soduco"></span></td>
    </tr>
    <tr>
      <td> </td>
      <td>  </td>
      <td> </td>
      <td>Tổng phát sinh</td>
      <td></td>
      <td></td>
      <td></td>
      <td><span id="tongphatsinh"></span></td>
      <td></td>
    </tr>
    <tr>
        <td> </td>
        <td>  </td>
        <td> </td>
        <td>Số dư cuối kỳ</td>
        <td></td>
        <td></td>
        <td></td>
        <td><span id="soducuoiky"></span></td>
        <td>0</td>
    </tr>
    <!-- Bạn có thể thêm dòng ở đây nếu cần -->
  </table>

  <div class="footer-signature">
    <div class="signature-block">
      <div class="title">Thủ quỹ</div>
      <div class="note">(Ký, họ tên)</div>
    </div>
    <div class="signature-block">
      <div class="title">Kế toán trưởng</div>
      <div class="note">(Ký, họ tên)</div>
      <div class="name">Trần Thị Nở</div>
    </div>
    <div class="signature-block">
      <div class="title">Giám đốc</div>
      <div class="note">(Ký, họ tên, đóng dấu)</div>
      <div class="name">Vũ Xuân Quân</div>
    </div>
  </div>
  <script>
    const params = new URLSearchParams(window.location.search);
    const start = params.get("start");
    const end = params.get("end");
    const matk = params.get("matk");

    if (start && end && matk === "131") {
      fetch(`/api/socaiphaithu?start=${start}&end=${end}&matk=${matk}`)
        .then(res => res.json())
        .then(data => {
          if (data.error) {
            document.getElementById("sodu").innerText = "Lỗi: " + data.error;
            return;
          }

          document.getElementById('ngaybatdau').textContent = start;
          document.getElementById('ngayketthuc').textContent = end;

          // Hiển thị số dư đầu kỳ
          const sodu = data.sodudauky || {};
          const duNo = sodu.DuNo || 0;
          const duCo = sodu.DuCo || 0;
          document.getElementById('soduno').textContent = duNo;
          document.getElementById('soduco').textContent = duCo;

          let tongNo = 0;
          // data.ctphieu.forEach(row => {
          //   tongNo += row.TienNo || 0;
          // });
          data.ctphieu.forEach((item, index) => {
            tongNo += item.SoTien  || 0;
          });

          let soducuoiky = duNo + tongNo - duCo;
          document.getElementById('tongphatsinh').textContent = tongNo;
          document.getElementById('soducuoiky').textContent = soducuoiky;
        })
        .catch(err => {
          document.getElementById("sodu").innerText = "Lỗi khi tải dữ liệu: " + err.message;
        });
    } else {
      document.getElementById("sodu").innerText =
        "Thiếu tham số hoặc mã tài khoản không hợp lệ.";
    }
  </script>

</body>
</html>
